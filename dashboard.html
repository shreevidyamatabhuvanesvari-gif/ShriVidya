<script>
const fixedTopics={
"рдЗрддрд┐рд╣рд╛рд╕":["рдкреНрд░рд╛рдЪреАрди рднрд╛рд░рдд","рдордзреНрдпрдХрд╛рд▓реАрди рднрд╛рд░рдд","рдЖрдзреБрдирд┐рдХ рднрд╛рд░рдд"],
"рд╡рд┐рдЬреНрдЮрд╛рди":["рднреМрддрд┐рдХреА","рд░рд╕рд╛рдпрди рд╡рд┐рдЬреНрдЮрд╛рди","рдЬреАрд╡ рд╡рд┐рдЬреНрдЮрд╛рди"],
"рд╕рд╛рдорд╛рдиреНрдп рдЬреНрдЮрд╛рди":["рднрд╛рд░рдд","рд╡рд┐рд╢реНрд╡","рдЦреЗрд▓"]
};

function getTopics(sub){
const custom=JSON.parse(localStorage.getItem("custom_"+sub)||"[]");
return [...fixedTopics[sub],...custom];
}

function openSubject(sub){
let html=`<h3>${sub} тАФ рдЯреЙрдкрд┐рдХ рдЪреБрдиреЗрдВ</h3>`;
getTopics(sub).forEach(t=>{
html+=`<button onclick="openTopic('${sub}','${t}')">${t}</button>`;
});
html+=`<br><button onclick="location.reload()">тмЕя╕П рд╡рд╛рдкрд╕</button>`;
quizPanel.innerHTML=html;
}

function openTopic(sub,topic){
quizPanel.innerHTML=`
<h3>${topic}</h3>

<button onclick="addOne('${sub}','${topic}')">тЮХ One-liner рдЬреЛрдбрд╝реЗрдВ</button>
<button onclick="viewOne('${sub}','${topic}')">ЁЯСА One-liner рджреЗрдЦреЗрдВ</button>
<br>
<button onclick="addQuiz('${sub}','${topic}')">тЮХ Quiz рдЬреЛрдбрд╝реЗрдВ</button>
<button onclick="viewQuiz('${sub}','${topic}')">ЁЯСА Quiz рджреЗрдЦреЗрдВ</button>
<br><br>
<button onclick="openSubject('${sub}')">тмЕя╕П рд╡рд╛рдкрд╕</button>
`;
}

/* ================= ONE LINER ================= */

function addOne(sub,topic,index=null){
let qVal="",aVal="",btn="рд╕реЗрд╡";

if(index!==null){
let arr=JSON.parse(localStorage.getItem(sub+topic+"one")||"[]");
qVal=arr[index].q;
aVal=arr[index].a;
btn="рдЕрдкрдбреЗрдЯ";
}

quizPanel.innerHTML=`
<h3>One-liner рдЬреЛрдбрд╝реЗрдВ</h3>
<input id="q" value="${qVal}" placeholder="рдкреНрд░рд╢реНрди:">
<input id="a" value="${aVal}" placeholder="рдЙрддреНрддрд░:">
<button onclick="saveOne('${sub}','${topic}',${index})">${btn}</button>
`;
}

function saveOne(sub,topic,index){
let key=sub+topic+"one";
let arr=JSON.parse(localStorage.getItem(key)||"[]");

let data={q:q.value,a:a.value};

if(index===null || index===undefined){
arr.push(data);
}else{
arr[index]=data;
}

localStorage.setItem(key,JSON.stringify(arr));
alert("рд╕реЗрд╡ рд╣реЛ рдЧрдпрд╛");
openTopic(sub,topic);
}

function viewOne(sub,topic){
let key=sub+topic+"one";
let arr=JSON.parse(localStorage.getItem(key)||"[]");

let html="<h3>One-liners</h3>";

arr.forEach((x,i)=>{
html+=`
<p>
<b>рдкреНрд░рд╢реНрди:</b> ${x.q}<br>
<b>рдЙрддреНрддрд░:</b> ${x.a}<br>
<button onclick="addOne('${sub}','${topic}',${i})">тЬПя╕П рд╕рдВрд╢реЛрдзрди</button>
</p><hr>`;
});

html+=`<button onclick="openTopic('${sub}','${topic}')">тмЕя╕П рд╡рд╛рдкрд╕</button>`;
quizPanel.innerHTML=html;
}

/* ================= QUIZ ================= */

function addQuiz(sub,topic,index=null){

let data={q:"",A:"",B:"",C:"",D:"",ans:"",exp:""};
let btn="рд╕реЗрд╡";

if(index!==null){
let arr=JSON.parse(localStorage.getItem(sub+topic+"quiz")||"[]");
data=arr[index];
btn="рдЕрдкрдбреЗрдЯ";
}

quizPanel.innerHTML=`
<h3>Quiz рдЬреЛрдбрд╝реЗрдВ</h3>

<input id="q" value="${data.q}" placeholder="рдкреНрд░рд╢реНрди:">
<input id="a1" value="${data.A}" placeholder="(A)">
<input id="a2" value="${data.B}" placeholder="(B)">
<input id="a3" value="${data.C}" placeholder="(C)">
<input id="a4" value="${data.D}" placeholder="(D)">
<input id="ans" value="${data.ans}" placeholder="рдЙрддреНрддрд░:">
<input id="exp" value="${data.exp}" placeholder="рд╡реНрдпрд╛рдЦреНрдпрд╛:">

<button onclick="saveQuiz('${sub}','${topic}',${index})">${btn}</button>
`;
}

function saveQuiz(sub,topic,index){
let key=sub+topic+"quiz";
let arr=JSON.parse(localStorage.getItem(key)||"[]");

let data={
q:q.value,
A:a1.value,
B:a2.value,
C:a3.value,
D:a4.value,
ans:ans.value,
exp:exp.value
};

if(index===null || index===undefined){
arr.push(data);
}else{
arr[index]=data;
}

localStorage.setItem(key,JSON.stringify(arr));
alert("Quiz рд╕реЗрд╡");
openTopic(sub,topic);
}

function viewQuiz(sub,topic){
let key=sub+topic+"quiz";
let arr=JSON.parse(localStorage.getItem(key)||"[]");

let html="<h3>Quiz</h3>";

arr.forEach((x,i)=>{
html+=`
<p>
<b>рдкреНрд░рд╢реНрди:</b> ${x.q}<br>
(A) ${x.A}<br>
(B) ${x.B}<br>
(C) ${x.C}<br>
(D) ${x.D}<br>
<b>рдЙрддреНрддрд░:</b> ${x.ans}<br>
<b>рд╡реНрдпрд╛рдЦреНрдпрд╛:</b> ${x.exp}<br>
<button onclick="addQuiz('${sub}','${topic}',${i})">тЬПя╕П рд╕рдВрд╢реЛрдзрди</button>
</p><hr>`;
});

html+=`<button onclick="openTopic('${sub}','${topic}')">тмЕя╕П рд╡рд╛рдкрд╕</button>`;
quizPanel.innerHTML=html;
}
</script>
